<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ticketing98 - Create Project</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="https://unpkg.com/98.css@0.1.21/dist/98.css" rel="stylesheet"/>
    <link href="css/styles.css" rel="stylesheet"/>
    <script defer src="js/index.js"></script>
    <script src="js/formHelper.js"></script>
</head>
<body class="common-body">
<div class="window" id="sidenav">
    <div class="title-bar">
        <div class="title-bar-text">Ticketing98</div>
    </div>
    <div class="window-body sidenav-body">
        <a href="dashboard.html">
            <button>Dashboard</button>
        </a>
        <a href="projects.html">
            <button>Projects</button>
        </a>
        <a href="tickets.html">
            <button>Tickets</button>
        </a>
    </div>
</div>
<div class="window" id="main">
    <div class="title-bar">
        <div class="title-bar-text">Project Wizard</div>
    </div>
    <div class="window-body" style="display: flex; flex-direction: column; align-items: flex-start">
        <h4 style="flex-shrink: 0">Project Wizard</h4>
        <div class="window-content">
            <form class="basic-form" id="create-project-form">
                <div class="field-row-stacked">
                    <label for="name">Project Name</label>
                    <input id="name" required type="text"/>
                    <div class="hidden font-13px error-message" id="name-error">
                        <img alt="Error Name" height="16" src="icons/msg_error-2.png" width="16">
                        <span>A project must have a name!</span>
                    </div>
                </div>
                <div class="field-row-stacked">
                    <label for="issue-prefix">Issue Prefix</label>
                    <input id="issue-prefix" maxlength="4" required style="max-width: 10ch" type="text"/>
                    <div class="hidden font-13px error-message" id="prefix-error">
                        <img alt="Error Prefix" height="16" src="icons/msg_error-2.png" width="16">
                        <span>A project must have a prefix!</span>
                    </div>
                </div>


                <div class="field-row-stacked">
                    <label for="contract">Contract</label>
                    <input accept="application/pdf" id="contract" required type="file" value="Contract"/>
                </div>
                <div class="field-row-stacked">
                    <span>Collaborators</span>
                    <div class="collaborators-input-container">
                        <div class="sunken-panel" style="min-height: 8rem; min-width: 150px">
                            <table id="collaborators-table">
                                <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Role</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                        <div>
                            <div class="field-row">
                                <label for="collaborator-email">Email</label>
                                <input id="collaborator-email" type="email"/>
                                <div class="hidden font-13px error-message" id="collaborator-email-error">
                                    <img alt="Error Collaborator Email" height="16" src="icons/msg_error-2.png"
                                         width="16">
                                    <span></span>
                                </div>
                            </div>
                            <div class="field-row">
                                <label for="collaborator-role">Role</label>
                                <select id="collaborator-role">
                                    <option hidden value="">Select Role</option>
                                    <option value="admin">Admin</option>
                                    <option value="developer">Developer</option>
                                </select>
                                <div class="hidden font-13px error-message" id="collaborator-role-error">
                                    <img alt="Error Collaborator Role" height="16" src="icons/msg_error-2.png"
                                         width="16">
                                    <span></span>
                                </div>
                            </div>
                            <input id="add-collaborator" onclick="addCollaborator()" type="button"
                                   value="Add collaborator"/>
                        </div>
                    </div>
                </div>
            </form>
            <script>
                let collaborators = {}

                function addCollaborator() {
                    let collaborator = document.getElementById('collaborator-email');
                    let role = document.getElementById('collaborator-role');
                    let valid = true;

                    valid &= checkInput(collaborator, 'collaborator-email-error', [
                        emptyCondition("Collaborator must not be empty!"),
                        emailCondition("Email is invalid!"),
                        {
                            errorPredicate: input => input.value in collaborators,
                            message: "Collaborator already exists!"
                        }
                    ]);
                    valid &= checkInput(role, 'collaborator-role-error', [emptyCondition("A role is required!")]);

                    if (valid) {
                        let collaboratorTable = document.querySelector("#collaborators-table tbody");
                        const row = `
                        <tr>
                            <td>${collaborator.value}</td>
                            <td>${role.value}</td>
                        </tr>
                        `
                        collaboratorTable.insertAdjacentHTML('beforeend', row);
                        collaborators[collaborator.value] = role.value;
                        collaborator.value = ""
                        role.value = ""
                    }
                }

                document.getElementById('create-project-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    let valid = true;
                    valid &= checkInput('name', 'name-error', [emptyCondition("Name is required!")]);
                    valid &= checkInput('contract', 'contract-error', [emptyCondition("A contract is required!")]);
                    valid &= checkInput('issue-prefix', 'issue-prefix-error', [emptyCondition("Issue prefix is required!"), lengthCondition(4, "Prefix must be at most 4 characters long!")]);
                    if (valid) location.href = 'project.html'
                })
            </script>
        </div>
        <p>These options can be modified later on.</p>
        <input form="create-project-form" type="submit" value="Create Project"/>
    </div>
</div>
<div class="window bottom-nav-bar">
    <button class="start-menu-button" onclick="startMenuClick()">
        <img alt="Start Icon" src="icons/windows-0.png">
        <span><b>Start Menu</b></span>
    </button>
</div>
</body>
</html>